<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ FIJI BOD TEST SUITE</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        h1 { color: #ffd700; }
        h2 { color: #00d4ff; margin-top: 2rem; }
        .test-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 2px solid transparent;
        }
        .test-section.running { border-color: #00d4ff; }
        .test-section.pass { border-color: #00ff00; }
        .test-section.fail { border-color: #ff4500; }
        button {
            background: linear-gradient(135deg, #ff4500, #ff6b35);
            border: none;
            border-radius: 10px;
            padding: 1rem 2rem;
            color: white;
            font-weight: 800;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover { transform: scale(1.05); }
        .result { margin-top: 1rem; padding: 1rem; border-radius: 10px; }
        .result pre { white-space: pre-wrap; word-break: break-word; }
        .pass .result { background: rgba(0,255,0,0.1); }
        .fail .result { background: rgba(255,0,0,0.1); }
        .env-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 800;
        }
        .env-badge.prod { background: #00ff00; color: #000; }
        .env-badge.beta { background: #ff6b35; color: #fff; }
        .summary {
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: center;
            font-size: 1.2rem;
            display: none;
        }
    </style>
</head>
<body>
    <div id="envBadge" class="env-badge">Checking...</div>

    <h1>üß™ Fiji Bod Test Suite</h1>
    <p>Automated testing for all API endpoints and functionality.</p>

    <div id="summaryBox" class="summary"></div>

    <div style="text-align: center; margin: 2rem 0;">
        <button onclick="runAllTests()" style="font-size: 1.2rem; padding: 1.5rem 3rem;">üöÄ RUN ALL TESTS</button>
    </div>

    <!-- USERS -->
    <h2>üë§ Users</h2>

    <div class="test-section" id="t-health">
        <h3>1. Health Check</h3>
        <button onclick="testHealth()">Run</button>
        <div class="result" id="r-health"></div>
    </div>

    <div class="test-section" id="t-createUser">
        <h3>2. Create User (POST /api/users)</h3>
        <button onclick="testCreateUser()">Run</button>
        <div class="result" id="r-createUser"></div>
    </div>

    <div class="test-section" id="t-getUser">
        <h3>3. Get User by Name (GET /api/users/:name)</h3>
        <button onclick="testGetUser()">Run</button>
        <div class="result" id="r-getUser"></div>
    </div>

    <div class="test-section" id="t-getAllUsers">
        <h3>4. Get All Users (GET /api/users)</h3>
        <button onclick="testGetAllUsers()">Run</button>
        <div class="result" id="r-getAllUsers"></div>
    </div>

    <div class="test-section" id="t-updateWeight">
        <h3>5. Update Weight (PUT /api/users)</h3>
        <button onclick="testUpdateWeight()">Run</button>
        <div class="result" id="r-updateWeight"></div>
    </div>

    <div class="test-section" id="t-goalType">
        <h3>6. Set Goal Type (PUT /api/users)</h3>
        <button onclick="testGoalType()">Run</button>
        <div class="result" id="r-goalType"></div>
    </div>

    <!-- WORKOUTS -->
    <h2>üí™ Workouts</h2>

    <div class="test-section" id="t-logWorkout">
        <h3>7. Log Workout (POST /api/workouts)</h3>
        <button onclick="testLogWorkout()">Run</button>
        <div class="result" id="r-logWorkout"></div>
    </div>

    <div class="test-section" id="t-getWorkouts">
        <h3>8. Get All Workouts (GET /api/workouts)</h3>
        <button onclick="testGetWorkouts()">Run</button>
        <div class="result" id="r-getWorkouts"></div>
    </div>

    <div class="test-section" id="t-recentWorkouts">
        <h3>9. Recent Workouts (GET /api/workouts/recent)</h3>
        <button onclick="testRecentWorkouts()">Run</button>
        <div class="result" id="r-recentWorkouts"></div>
    </div>

    <div class="test-section" id="t-workoutsByUser">
        <h3>10. Workouts by User (GET /api/workouts/by-user)</h3>
        <button onclick="testWorkoutsByUser()">Run</button>
        <div class="result" id="r-workoutsByUser"></div>
    </div>

    <div class="test-section" id="t-editWorkout">
        <h3>11. Edit Workout (PUT /api/workouts/:id)</h3>
        <button onclick="testEditWorkout()">Run</button>
        <div class="result" id="r-editWorkout"></div>
    </div>

    <div class="test-section" id="t-deleteWorkout">
        <h3>12. Delete Workout (DELETE /api/workouts/:id)</h3>
        <button onclick="testDeleteWorkout()">Run</button>
        <div class="result" id="r-deleteWorkout"></div>
    </div>

    <!-- LEADERBOARD & STATS -->
    <h2>üèÜ Leaderboard & Stats</h2>

    <div class="test-section" id="t-leaderboard">
        <h3>13. Leaderboard (GET /api/leaderboard)</h3>
        <button onclick="testLeaderboard()">Run</button>
        <div class="result" id="r-leaderboard"></div>
    </div>

    <div class="test-section" id="t-stats">
        <h3>14. Global Stats (GET /api/stats)</h3>
        <button onclick="testStats()">Run</button>
        <div class="result" id="r-stats"></div>
    </div>

    <div class="test-section" id="t-recalcStreaks">
        <h3>15. Recalculate Streaks (POST /api/admin/recalculate-streaks)</h3>
        <button onclick="testRecalcStreaks()">Run</button>
        <div class="result" id="r-recalcStreaks"></div>
    </div>

    <!-- CHALLENGES -->
    <h2>‚öîÔ∏è Challenges</h2>

    <div class="test-section" id="t-activeChallenge">
        <h3>16. Active Challenge (GET /api/challenges/active)</h3>
        <button onclick="testActiveChallenge()">Run</button>
        <div class="result" id="r-activeChallenge"></div>
    </div>

    <div class="test-section" id="t-allChallenges">
        <h3>17. All Challenges / Calendar (GET /api/challenges)</h3>
        <button onclick="testAllChallenges()">Run</button>
        <div class="result" id="r-allChallenges"></div>
    </div>

    <div class="test-section" id="t-joinChallenge">
        <h3>18. Join Challenge (POST /api/challenge-entries)</h3>
        <button onclick="testJoinChallenge()">Run</button>
        <div class="result" id="r-joinChallenge"></div>
    </div>

    <div class="test-section" id="t-challengeEntries">
        <h3>19. Get Challenge Entries (GET /api/challenge-entries)</h3>
        <button onclick="testChallengeEntries()">Run</button>
        <div class="result" id="r-challengeEntries"></div>
    </div>

    <!-- MESSAGES -->
    <h2>üí¨ Messages</h2>

    <div class="test-section" id="t-postMessage">
        <h3>20. Post Message (POST /api/messages)</h3>
        <button onclick="testPostMessage()">Run</button>
        <div class="result" id="r-postMessage"></div>
    </div>

    <div class="test-section" id="t-getMessages">
        <h3>21. Get Messages (GET /api/messages)</h3>
        <button onclick="testGetMessages()">Run</button>
        <div class="result" id="r-getMessages"></div>
    </div>

    <div class="test-section" id="t-editMessage">
        <h3>22. Edit Message (PUT /api/messages/:id)</h3>
        <button onclick="testEditMessage()">Run</button>
        <div class="result" id="r-editMessage"></div>
    </div>

    <div class="test-section" id="t-deleteMessage">
        <h3>23. Delete Message (DELETE /api/messages/:id)</h3>
        <button onclick="testDeleteMessage()">Run</button>
        <div class="result" id="r-deleteMessage"></div>
    </div>

    <!-- SECURITY -->
    <h2>üîí Security</h2>

    <div class="test-section" id="t-unauthEdit">
        <h3>24. Unauthorized Workout Edit</h3>
        <button onclick="testUnauthWorkoutEdit()">Run</button>
        <div class="result" id="r-unauthEdit"></div>
    </div>

    <div class="test-section" id="t-unauthDelete">
        <h3>25. Unauthorized Workout Delete</h3>
        <button onclick="testUnauthWorkoutDelete()">Run</button>
        <div class="result" id="r-unauthDelete"></div>
    </div>

    <div class="test-section" id="t-unauthMsgEdit">
        <h3>26. Unauthorized Message Edit</h3>
        <button onclick="testUnauthMsgEdit()">Run</button>
        <div class="result" id="r-unauthMsgEdit"></div>
    </div>

    <div class="test-section" id="t-unauthMsgDelete">
        <h3>27. Unauthorized Message Delete</h3>
        <button onclick="testUnauthMsgDelete()">Run</button>
        <div class="result" id="r-unauthMsgDelete"></div>
    </div>

    <script src="beta-config.js"></script>
    <script>
        const badge = document.getElementById('envBadge');
        badge.textContent = isBeta ? 'BETA ENV' : 'PRODUCTION';
        badge.className = 'env-badge ' + (isBeta ? 'beta' : 'prod');

        const TEST_USER = 'TestUser_' + Date.now();
        const HACKER = 'Hacker_' + Date.now();
        let lastWorkoutId = null;
        let lastMessageId = null;
        let activeChallengeId = null;

        // -- Helpers --
        function show(id, data) {
            document.getElementById('r-' + id).innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }
        function mark(id, pass) {
            document.getElementById('t-' + id).className = 'test-section ' + (pass ? 'pass' : 'fail');
        }
        function run(id) {
            document.getElementById('t-' + id).className = 'test-section running';
        }
        function isAuthError(res, data) {
            return res.status === 403 || res.status === 404 ||
                   data.error?.includes('authorized') || data.error?.includes('not found');
        }

        // ========== USERS ==========

        async function testHealth() {
            run('health');
            try {
                const res = await fetch(`${API_URL}/api/health`);
                const data = await res.json();
                show('health', data);
                mark('health', data.status === 'ok');
            } catch (e) { show('health', e.message); mark('health', false); }
        }

        async function testCreateUser() {
            run('createUser');
            try {
                const res = await fetch(`${API_URL}/api/users`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: TEST_USER, start_weight: 200, goal_weight: 180 })
                });
                const data = await res.json();
                show('createUser', data);
                mark('createUser', data.success || data.existing);
            } catch (e) { show('createUser', e.message); mark('createUser', false); }
        }

        async function testGetUser() {
            run('getUser');
            try {
                const res = await fetch(`${API_URL}/api/users/${encodeURIComponent(TEST_USER)}`);
                const data = await res.json();
                show('getUser', data);
                mark('getUser', data.name === TEST_USER);
            } catch (e) { show('getUser', e.message); mark('getUser', false); }
        }

        async function testGetAllUsers() {
            run('getAllUsers');
            try {
                const res = await fetch(`${API_URL}/api/users`);
                const data = await res.json();
                show('getAllUsers', { count: data.length, sample: data.slice(0, 3).map(u => u.name) });
                mark('getAllUsers', Array.isArray(data) && data.length > 0);
            } catch (e) { show('getAllUsers', e.message); mark('getAllUsers', false); }
        }

        async function testUpdateWeight() {
            run('updateWeight');
            try {
                const res = await fetch(`${API_URL}/api/users`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: TEST_USER, current_weight: 195 })
                });
                const data = await res.json();
                show('updateWeight', data);
                mark('updateWeight', data.success);
            } catch (e) { show('updateWeight', e.message); mark('updateWeight', false); }
        }

        async function testGoalType() {
            run('goalType');
            try {
                const res = await fetch(`${API_URL}/api/users`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: TEST_USER, current_weight: 210, goal_weight: 220, goal_type: 'gain' })
                });
                const data = await res.json();
                show('goalType', data);
                mark('goalType', data.success && data.user?.goal_type === 'gain');
            } catch (e) { show('goalType', e.message); mark('goalType', false); }
        }

        // ========== WORKOUTS ==========

        async function testLogWorkout() {
            run('logWorkout');
            try {
                const res = await fetch(`${API_URL}/api/workouts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_name: TEST_USER, workout_type: 'Pushups', amount: '50 reps' })
                });
                const data = await res.json();
                if (data.success && data.workout) lastWorkoutId = data.workout.id;
                show('logWorkout', data);
                mark('logWorkout', data.success);
            } catch (e) { show('logWorkout', e.message); mark('logWorkout', false); }
        }

        async function testGetWorkouts() {
            run('getWorkouts');
            try {
                const res = await fetch(`${API_URL}/api/workouts`);
                const data = await res.json();
                show('getWorkouts', { count: data.length, latest: data.slice(0, 2) });
                mark('getWorkouts', Array.isArray(data) && data.length > 0);
            } catch (e) { show('getWorkouts', e.message); mark('getWorkouts', false); }
        }

        async function testRecentWorkouts() {
            run('recentWorkouts');
            try {
                const res = await fetch(`${API_URL}/api/workouts/recent`);
                const data = await res.json();
                show('recentWorkouts', { count: data.length, sample: data.slice(0, 3) });
                mark('recentWorkouts', Array.isArray(data));
            } catch (e) { show('recentWorkouts', e.message); mark('recentWorkouts', false); }
        }

        async function testWorkoutsByUser() {
            run('workoutsByUser');
            try {
                const res = await fetch(`${API_URL}/api/workouts/by-user?user_name=${encodeURIComponent(TEST_USER)}`);
                const data = await res.json();
                show('workoutsByUser', data);
                mark('workoutsByUser', Array.isArray(data) && data.length > 0);
            } catch (e) { show('workoutsByUser', e.message); mark('workoutsByUser', false); }
        }

        async function testEditWorkout() {
            run('editWorkout');
            if (!lastWorkoutId) await testLogWorkout();
            try {
                const res = await fetch(`${API_URL}/api/workouts/${lastWorkoutId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_name: TEST_USER, workout_type: 'Pullups', amount: '20 reps' })
                });
                const data = await res.json();
                show('editWorkout', data);
                mark('editWorkout', data.success);
            } catch (e) { show('editWorkout', e.message); mark('editWorkout', false); }
        }

        async function testDeleteWorkout() {
            run('deleteWorkout');
            if (!lastWorkoutId) { show('deleteWorkout', 'No workout to delete'); mark('deleteWorkout', false); return; }
            try {
                const res = await fetch(`${API_URL}/api/workouts/${lastWorkoutId}?user_name=${encodeURIComponent(TEST_USER)}`, { method: 'DELETE' });
                const data = await res.json();
                show('deleteWorkout', data);
                mark('deleteWorkout', data.success);
                lastWorkoutId = null;
            } catch (e) { show('deleteWorkout', e.message); mark('deleteWorkout', false); }
        }

        // ========== LEADERBOARD & STATS ==========

        async function testLeaderboard() {
            run('leaderboard');
            try {
                const res = await fetch(`${API_URL}/api/leaderboard`);
                const data = await res.json();
                show('leaderboard', data.slice(0, 3));
                mark('leaderboard', Array.isArray(data));
            } catch (e) { show('leaderboard', e.message); mark('leaderboard', false); }
        }

        async function testStats() {
            run('stats');
            try {
                const res = await fetch(`${API_URL}/api/stats`);
                const data = await res.json();
                show('stats', data);
                mark('stats', data.total_workouts !== undefined || data.active_users !== undefined);
            } catch (e) { show('stats', e.message); mark('stats', false); }
        }

        async function testRecalcStreaks() {
            run('recalcStreaks');
            try {
                const res = await fetch(`${API_URL}/api/admin/recalculate-streaks`, { method: 'POST' });
                const data = await res.json();
                show('recalcStreaks', data);
                mark('recalcStreaks', data.success);
            } catch (e) { show('recalcStreaks', e.message); mark('recalcStreaks', false); }
        }

        // ========== CHALLENGES ==========

        async function testActiveChallenge() {
            run('activeChallenge');
            try {
                const res = await fetch(`${API_URL}/api/challenges/active`);
                const data = await res.json();
                if (data.id) activeChallengeId = data.id;
                show('activeChallenge', data);
                mark('activeChallenge', !!data.name);
            } catch (e) { show('activeChallenge', e.message); mark('activeChallenge', false); }
        }

        async function testAllChallenges() {
            run('allChallenges');
            try {
                const res = await fetch(`${API_URL}/api/challenges`);
                const data = await res.json();
                const now = new Date().toISOString().slice(0, 10);
                const active = data.find(c => now >= c.start_date && now <= c.end_date);
                show('allChallenges', {
                    total: data.length,
                    first: data[0]?.name,
                    last: data[data.length - 1]?.name,
                    activeWeek: active ? `Week ${active.week_number}: ${active.name}` : 'None',
                    dateRange: `${data[0]?.start_date} ‚Üí ${data[data.length - 1]?.end_date}`
                });
                mark('allChallenges', data.length === 17);
            } catch (e) { show('allChallenges', e.message); mark('allChallenges', false); }
        }

        async function testJoinChallenge() {
            run('joinChallenge');
            if (!activeChallengeId) await testActiveChallenge();
            try {
                const res = await fetch(`${API_URL}/api/challenge-entries`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_name: TEST_USER, challenge_id: activeChallengeId, score: 42, notes: 'Test entry' })
                });
                const data = await res.json();
                show('joinChallenge', data);
                mark('joinChallenge', data.success);
            } catch (e) { show('joinChallenge', e.message); mark('joinChallenge', false); }
        }

        async function testChallengeEntries() {
            run('challengeEntries');
            if (!activeChallengeId) await testActiveChallenge();
            try {
                const res = await fetch(`${API_URL}/api/challenge-entries?challenge_id=${activeChallengeId}`);
                const data = await res.json();
                show('challengeEntries', data);
                mark('challengeEntries', Array.isArray(data));
            } catch (e) { show('challengeEntries', e.message); mark('challengeEntries', false); }
        }

        // ========== MESSAGES ==========

        async function testPostMessage() {
            run('postMessage');
            try {
                const res = await fetch(`${API_URL}/api/messages`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_name: TEST_USER, message: 'Automated test message üî•' })
                });
                const data = await res.json();
                if (data.success && data.message) lastMessageId = data.message.id;
                show('postMessage', data);
                mark('postMessage', data.success);
            } catch (e) { show('postMessage', e.message); mark('postMessage', false); }
        }

        async function testGetMessages() {
            run('getMessages');
            try {
                const res = await fetch(`${API_URL}/api/messages`);
                const data = await res.json();
                show('getMessages', { count: data.length, latest: data.slice(0, 3) });
                mark('getMessages', Array.isArray(data) && data.length > 0);
            } catch (e) { show('getMessages', e.message); mark('getMessages', false); }
        }

        async function testEditMessage() {
            run('editMessage');
            if (!lastMessageId) await testPostMessage();
            try {
                const res = await fetch(`${API_URL}/api/messages/${lastMessageId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_name: TEST_USER, message: 'Edited test message ‚úèÔ∏è' })
                });
                const data = await res.json();
                show('editMessage', data);
                mark('editMessage', data.success);
            } catch (e) { show('editMessage', e.message); mark('editMessage', false); }
        }

        async function testDeleteMessage() {
            run('deleteMessage');
            if (!lastMessageId) { show('deleteMessage', 'No message to delete'); mark('deleteMessage', false); return; }
            try {
                const res = await fetch(`${API_URL}/api/messages/${lastMessageId}?user_name=${encodeURIComponent(TEST_USER)}`, { method: 'DELETE' });
                const data = await res.json();
                show('deleteMessage', data);
                mark('deleteMessage', data.success);
                lastMessageId = null;
            } catch (e) { show('deleteMessage', e.message); mark('deleteMessage', false); }
        }

        // ========== SECURITY ==========

        async function createTestWorkout() {
            const res = await fetch(`${API_URL}/api/workouts`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_name: TEST_USER, workout_type: 'SecurityTest', amount: '10 reps' })
            });
            const data = await res.json();
            return data.success ? data.workout.id : null;
        }

        async function createTestMessage() {
            const res = await fetch(`${API_URL}/api/messages`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_name: TEST_USER, message: 'Security test msg' })
            });
            const data = await res.json();
            return data.success ? data.message.id : null;
        }

        async function testUnauthWorkoutEdit() {
            run('unauthEdit');
            try {
                const wid = await createTestWorkout();
                if (!wid) { show('unauthEdit', 'Failed to create test workout'); mark('unauthEdit', false); return; }
                const res = await fetch(`${API_URL}/api/workouts/${wid}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_name: HACKER, workout_type: 'Hacked', amount: '999' })
                });
                const data = await res.json();
                show('unauthEdit', { workoutId: wid, status: res.status, response: data });
                mark('unauthEdit', isAuthError(res, data));
            } catch (e) { show('unauthEdit', e.message); mark('unauthEdit', false); }
        }

        async function testUnauthWorkoutDelete() {
            run('unauthDelete');
            try {
                const wid = await createTestWorkout();
                if (!wid) { show('unauthDelete', 'Failed to create test workout'); mark('unauthDelete', false); return; }
                const res = await fetch(`${API_URL}/api/workouts/${wid}?user_name=${encodeURIComponent(HACKER)}`, { method: 'DELETE' });
                const data = await res.json();
                show('unauthDelete', { workoutId: wid, status: res.status, response: data });
                mark('unauthDelete', isAuthError(res, data));
            } catch (e) { show('unauthDelete', e.message); mark('unauthDelete', false); }
        }

        async function testUnauthMsgEdit() {
            run('unauthMsgEdit');
            try {
                const mid = await createTestMessage();
                if (!mid) { show('unauthMsgEdit', 'Failed to create test message'); mark('unauthMsgEdit', false); return; }
                const res = await fetch(`${API_URL}/api/messages/${mid}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_name: HACKER, message: 'Hacked msg' })
                });
                const data = await res.json();
                show('unauthMsgEdit', { messageId: mid, status: res.status, response: data });
                mark('unauthMsgEdit', isAuthError(res, data));
            } catch (e) { show('unauthMsgEdit', e.message); mark('unauthMsgEdit', false); }
        }

        async function testUnauthMsgDelete() {
            run('unauthMsgDelete');
            try {
                const mid = await createTestMessage();
                if (!mid) { show('unauthMsgDelete', 'Failed to create test message'); mark('unauthMsgDelete', false); return; }
                const res = await fetch(`${API_URL}/api/messages/${mid}?user_name=${encodeURIComponent(HACKER)}`, { method: 'DELETE' });
                const data = await res.json();
                show('unauthMsgDelete', { messageId: mid, status: res.status, response: data });
                mark('unauthMsgDelete', isAuthError(res, data));
            } catch (e) { show('unauthMsgDelete', e.message); mark('unauthMsgDelete', false); }
        }

        // ========== RUN ALL ==========

        async function runAllTests() {
            const box = document.getElementById('summaryBox');
            box.style.display = 'block';
            box.innerHTML = '‚è≥ Running tests...';
            box.style.borderColor = '#00d4ff';

            await testHealth();
            await testCreateUser();
            await testGetUser();
            await testGetAllUsers();
            await testUpdateWeight();
            await testGoalType();
            await testLogWorkout();
            await testGetWorkouts();
            await testRecentWorkouts();
            await testWorkoutsByUser();
            await testEditWorkout();
            await testDeleteWorkout();
            await testLeaderboard();
            await testStats();
            await testRecalcStreaks();
            await testActiveChallenge();
            await testAllChallenges();
            await testJoinChallenge();
            await testChallengeEntries();
            await testPostMessage();
            await testGetMessages();
            await testEditMessage();
            await testDeleteMessage();
            await testUnauthWorkoutEdit();
            await testUnauthWorkoutDelete();
            await testUnauthMsgEdit();
            await testUnauthMsgDelete();

            const passed = document.querySelectorAll('.test-section.pass').length;
            const failed = document.querySelectorAll('.test-section.fail').length;
            const total = passed + failed;
            box.innerHTML = `‚úÖ ${passed}/${total} passed` + (failed ? ` &nbsp; ‚ùå ${failed} failed` : ' &nbsp; üéâ All clear!');
            box.style.border = `2px solid ${failed ? '#ff4500' : '#00ff00'}`;
        }
    </script>
</body>
</html>
